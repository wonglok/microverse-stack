import{r as c,a as s,j as y,F as D}from"./index-638a475e.js";import{ab as l,aa as u,v as h,ac as d,ad as C,C as j}from"./MetaApp-0b96d073.js";function F({}){let i=c.useRef(),o=l(r=>r.collider),n=l(r=>r.game);return u(({raycaster:r,mouse:f,camera:t},a)=>{let e=n.controls;if(e&&o&&o.geometry){"ontouchstart"in window?r.setFromCamera({x:0,y:0},t):r.setFromCamera(f,t);let p=o.geometry.boundsTree;if(e){r.setFromCamera({x:0,y:0},t),r.ray.lookAt(e.target);let m=p.raycastFirst(r.ray);if(m&&m.distance<=e.getDistance()&&(e.deltaDir=e.deltaDir||0,e.deltaDir=h.lerp(e.deltaDir,m.distance-e.getDistance(),.4)),Math.abs(e.deltaDir)>0){let g=t.position.clone().sub(e.target).normalize();t.position.addScaledVector(g,a*25*e.deltaDir),e.deltaDir-=a*25*e.deltaDir}}}}),s("group",{ref:i})}function S({glb:i,offsetY:o=.01,children:n}){let r=d(a=>a.camera),f=d(a=>a.gl),t=l(a=>a.game);return c.useEffect(()=>(l.setState({game:new C({camera:r,gl:f})}),()=>{var a,e;(a=l.getState())!=null&&a.game&&((e=l.getState())==null||e.game.clean())}),[r,f]),c.useEffect(()=>{t&&(i!=null&&i.scene)&&t.parseScene({scene:i.scene})},[i,t]),c.useEffect(()=>{t&&o&&(t.offsetY=o)},[i,t]),u(()=>{t&&t.updatePlayer&&typeof t.updatePlayer=="function"&&t.updatePlayer()}),y("group",{onClick:a=>{console.log(a.object.name);let e=a.object;e.name==="Cylinder002_2"&&(e.material=e.material.clone(),e.material.color=new j("#ffffff"))},children:[s("group",{children:t&&s("primitive",{object:t.player})}),t&&s(D,{children:s(F,{})}),s("primitive",{object:i.scene}),typeof n=="function"&&n({glb:i})]})}export{S as MetaverseGLB};
